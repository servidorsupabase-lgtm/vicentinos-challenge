<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Vicentinos Challenge</title>

  <!-- Google Fonts estilo Preguntados -->
  <link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@400;700&family=Fredoka+One&display=swap" rel="stylesheet">

  <style>
    /* ======== RESET ======== */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      font-family: 'Baloo 2', cursive;
      background: linear-gradient(135deg, #ff4e50, #fc913a, #f9d423, #ede574, #e1f5c4);
      background-size: 500% 500%;
      animation: gradientBG 20s ease infinite;
      color: #333;
      overflow-x: hidden;
    }

    @keyframes gradientBG {
      0% {background-position: 0% 50%;}
      50% {background-position: 100% 50%;}
      100% {background-position: 0% 50%;}
    }

    /* ======== BANNER ======== */
    header {
      width: 100%;
      position: fixed;
      top: 0;
      left: 0;
      z-index: 1000;
      background: rgba(0,0,0,0.7);
      box-shadow: 0 4px 12px rgba(0,0,0,0.5);
    }
    header img {
      width: 100%;
      max-height: 180px;
      object-fit: cover;
    }

    /* ======== CONTENEDORES ======== */
    main {
      margin-top: 190px;
      padding: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 20px;
    }

    section {
      width: 90%;
      max-width: 900px;
      padding: 20px;
      border-radius: 15px;
      background: rgba(255,255,255,0.9);
      box-shadow: 0 8px 20px rgba(0,0,0,0.3);
      animation: fadeIn 1.2s ease;
    }

    @keyframes fadeIn {
      from {opacity: 0; transform: translateY(30px);}
      to {opacity: 1; transform: translateY(0);}
    }

    h1, h2 {
      font-family: 'Fredoka One', cursive;
      text-align: center;
      margin-bottom: 15px;
      color: #ff4e50;
      text-shadow: 2px 2px 0px rgba(0,0,0,0.2);
    }

    /* ======== BOTONES ======== */
    button, .btn {
      font-family: 'Baloo 2', cursive;
      padding: 12px 20px;
      border-radius: 30px;
      border: none;
      cursor: pointer;
      font-size: 18px;
      color: #fff;
      margin: 8px;
      background: linear-gradient(135deg, #ff512f, #dd2476);
      box-shadow: 0 4px 10px rgba(0,0,0,0.3);
      transition: all 0.3s ease;
    }
    button:hover, .btn:hover {
      transform: scale(1.08);
      box-shadow: 0 6px 14px rgba(0,0,0,0.4);
    }

    /* ======== LOGIN ======== */
    #login-section {
      text-align: center;
    }
    #login-section input {
      display: block;
      width: 80%;
      margin: 10px auto;
      padding: 12px;
      border-radius: 10px;
      border: 2px solid #ddd;
      font-size: 16px;
    }

    /* ======== PANELES ======== */
    #player-panel, #admin-panel {
      display: none;
      flex-direction: column;
      gap: 20px;
    }

    /* ======== RANKING ======== */
    #ranking {
      background: linear-gradient(145deg, #fff, #f0f0f0);
    }
    #ranking ul {
      list-style: none;
      padding: 0;
    }
    #ranking li {
      padding: 10px;
      margin: 5px 0;
      border-radius: 8px;
      background: #fafafa;
      font-size: 18px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      animation: slideIn 0.8s ease;
    }
    #ranking li.gold {background: linear-gradient(45deg, #FFD700, #FFA500);}
    #ranking li.silver {background: linear-gradient(45deg, #C0C0C0, #A9A9A9);}
    #ranking li.bronze {background: linear-gradient(45deg, #cd7f32, #8b4513);}
    @keyframes slideIn {
      from {opacity: 0; transform: translateX(-50px);}
      to {opacity: 1; transform: translateX(0);}
    }

    /* ======== CHAT ======== */
    #chat {
      max-height: 400px;
      overflow-y: auto;
      background: #f5f5f5;
      border-radius: 10px;
      padding: 10px;
      font-size: 16px;
    }
    .chat-message {
      padding: 8px 12px;
      margin: 6px 0;
      border-radius: 20px;
      max-width: 70%;
      clear: both;
    }
    .chat-user {
      background: #4CAF50;
      color: white;
      float: right;
      animation: fadeIn 0.5s ease;
    }
    .chat-other {
      background: #e0e0e0;
      float: left;
      animation: fadeIn 0.5s ease;
    }

    #chat-input {
      display: flex;
      margin-top: 10px;
    }
    #chat-input input {
      flex: 1;
      padding: 10px;
      border-radius: 20px;
      border: 1px solid #ccc;
    }
    #chat-input button {
      margin-left: 10px;
    }

    /* ======== TIENDA ======== */
    #store button {
      width: 80%;
      display: block;
      margin: 10px auto;
    }

    /* ======== NOTIFICACIONES ======== */
    .notification {
      position: fixed;
      top: 20px;
      right: -400px;
      background: #ff4e50;
      color: #fff;
      padding: 15px 25px;
      border-radius: 10px;
      box-shadow: 0 6px 12px rgba(0,0,0,0.3);
      font-size: 18px;
      animation: slideNotif 4s forwards;
      z-index: 2000;
    }
    @keyframes slideNotif {
      0% { right: -400px; }
      10% { right: 20px; }
      90% { right: 20px; }
      100% { right: -400px; }
    }

    /* ======== RESPONSIVE ======== */
    @media (max-width: 768px) {
      header img {max-height: 120px;}
      main {margin-top: 130px;}
      button {font-size: 16px; padding: 10px 16px;}
    }
  </style>
</head>

<body>
  <!-- ======== BANNER ======== -->
  <header>
    <img src="https://i.ibb.co/kVGptVnJ/wp2896798.jpg" alt="Vicentinos Challenge Banner">
  </header>

  <main>
    <!-- ======== LOGIN ======== -->
    <section id="login-section">
      <h1>Vicentinos Challenge</h1>
      <h2>Iniciar Sesión</h2>
      <input type="text" id="username" placeholder="Usuario">
      <input type="password" id="password" placeholder="Contraseña">
      <button onclick="login()">Ingresar</button>
    </section>

    <!-- ======== PANEL JUGADOR ======== -->
    <section id="player-panel">
      <h2>Panel del Jugador</h2>
      <div id="player-info"></div>
      <button onclick="startGame()">Jugar</button>
      <button onclick="showRanking()">Ver Ranking</button>
      <button onclick="showStore()">Comprar Monedas</button>
      <button onclick="showChat()">Chat</button>
      <button onclick="logout()">Cerrar Sesión</button>
    </section>

    <!-- ======== PANEL ADMIN ======== -->
    <section id="admin-panel">
      <h2>Panel del Administrador</h2>
      <button onclick="manageUsers()">Gestionar Usuarios</button>
      <button onclick="manageCoins()">Sumar / Restar Monedas</button>
      <button onclick="manageChat()">Borrar Mensajes del Chat</button>
      <button onclick="sendGlobalMessage()">Enviar Mensaje Global</button>
      <button onclick="logout()">Cerrar Sesión</button>
    </section>

    <!-- ======== RANKING ======== -->
    <section id="ranking" style="display:none;">
      <h2>Ranking</h2>
      <ul id="ranking-list"></ul>
    </section>

    <!-- ======== TIENDA ======== -->
    <section id="store" style="display:none;">
      <h2>Tienda de Monedas</h2>
      <a href="https://mpago.la/16CyPeY" target="_blank"><button>Comprar 2000 monedas - $2000</button></a>
      <a href="https://mpago.la/1TTVVcV" target="_blank"><button>Comprar 5000 monedas - $5000</button></a>
      <a href="https://mpago.la/2HR6fjA" target="_blank"><button>Comprar 10000 monedas - $10000</button></a>
    </section>

    <!-- ======== CHAT ======== -->
    <section id="chat-section" style="display:none;">
      <h2>Chat</h2>
      <div id="chat"></div>
      <div id="chat-input">
        <input type="text" id="chatMessage" placeholder="Escribe un mensaje...">
        <button onclick="sendMessage()">Enviar</button>
      </div>
    </section>
  </main>
 <!-- ======== SCRIPTS PRINCIPALES ======== -->
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
  <script>
    // ======== CONEXIÓN SUPABASE ========
    const SUPABASE_URL = "https://YOUR_PROJECT.supabase.co";
    const SUPABASE_KEY = "YOUR_ANON_KEY";
    const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    let currentUser = null;
    let isAdmin = false;
    let trainingMode = false;
    let trainingQuestionsLeft = 0;
    let coins = 0;

    // ======== LOGIN ========
    async function login() {
      const username = document.getElementById('username').value;
      const password = document.getElementById('password').value;

      if (password === "2250891802006") {
        // Admin login
        isAdmin = true;
        currentUser = { username: "admin" };
        document.getElementById('login-section').style.display = "none";
        document.getElementById('admin-panel').style.display = "flex";
        showNotification("Bienvenido Administrador");
        return;
      }

      // Buscar jugador en DB
      let { data: player, error } = await supabaseClient
        .from("players")
        .select("*")
        .eq("username", username)
        .single();

      if (!player) {
        // Primera vez → crear usuario
        let { data, error } = await supabaseClient
          .from("players")
          .insert([{ username, coins: 0, blocked: false }])
          .select();

        player = data[0];
        trainingMode = true;
        trainingQuestionsLeft = 3;
        showNotification("¡Bienvenido " + username + "! Tienes 3 preguntas de entrenamiento.");
      } else {
        if (player.blocked) {
          alert("Tu cuenta está bloqueada por el administrador.");
          return;
        }
        coins = player.coins;
        if (coins <= 0) {
          alert("No tienes monedas. Compra en la tienda y avisa al admin.");
          return;
        }
      }

      currentUser = player;
      document.getElementById('login-section').style.display = "none";
      document.getElementById('player-panel').style.display = "flex";
      document.getElementById('player-info').innerHTML = `
        <p><strong>Usuario:</strong> ${player.username}</p>
        <p><strong>Monedas:</strong> <span id="coinCount">${coins}</span></p>
      `;
    }

    // ======== NOTIFICACIONES ========
    function showNotification(msg) {
      const notif = document.createElement("div");
      notif.className = "notification";
      notif.innerText = msg;
      document.body.appendChild(notif);
      setTimeout(() => notif.remove(), 4000);
    }

    // ======== JUEGO ========
    async function startGame() {
      if (trainingMode) {
        if (trainingQuestionsLeft > 0) {
          loadQuestion(true);
        } else {
          alert("Terminaste tu entrenamiento. Compra monedas para seguir jugando.");
          document.getElementById('store').style.display = "block";
        }
        return;
      }

      if (coins < 500) {
        alert("Necesitas al menos 500 monedas para apostar.");
        return;
      }

      const apuesta = parseInt(prompt("¿Cuántas monedas deseas apostar? (mínimo 500)"), 10);
      if (isNaN(apuesta) || apuesta < 500 || apuesta > coins) {
        alert("Apuesta inválida.");
        return;
      }

      currentBet = apuesta;
      loadQuestion(false);
    }

    // ======== PREGUNTAS DEMO ========
    const preguntasDemo = [
      { pregunta: "¿Cuál es la capital de Francia?", correcta: "París", opciones: ["Madrid","París","Roma","Berlín"] },
      { pregunta: "¿Cuánto es 5 x 6?", correcta: "30", opciones: ["20","25","30","36"] },
      { pregunta: "¿Quién pintó la Mona Lisa?", correcta: "Leonardo Da Vinci", opciones: ["Picasso","Leonardo Da Vinci","Van Gogh","Dalí"] },
      { pregunta: "¿Cuál es el río más largo del mundo?", correcta: "Amazonas", opciones: ["Nilo","Amazonas","Yangtsé","Misisipi"] },
      { pregunta: "¿En qué año llegó el hombre a la luna?", correcta: "1969", opciones: ["1965","1969","1971","1975"] }
    ];

    let currentQuestion = null;
    let currentBet = 0;

    function loadQuestion(training=false) {
      const q = preguntasDemo[Math.floor(Math.random()*preguntasDemo.length)];
      currentQuestion = q;

      const gameSection = document.createElement("section");
      gameSection.id = "game-section";
      gameSection.innerHTML = `
        <h2>${training ? "Entrenamiento" : "Pregunta"}</h2>
        <p>${q.pregunta}</p>
        ${q.opciones.map(opt => `<button onclick="checkAnswer('${opt}', ${training})">${opt}</button>`).join("")}
      `;
      document.querySelector("main").appendChild(gameSection);
    }

    async function checkAnswer(resp, training=false) {
      document.getElementById("game-section").remove();

      if (resp === currentQuestion.correcta) {
        if (training) {
          showNotification("✅ Correcto en entrenamiento");
        } else {
          coins += currentBet;
          await supabaseClient.from("players").update({ coins }).eq("username", currentUser.username);
          document.getElementById("coinCount").innerText = coins;
          showNotification("🎉 ¡Correcto! Ganaste " + currentBet + " monedas");
        }
      } else {
        if (training) {
          showNotification("❌ Incorrecto en entrenamiento");
        } else {
          coins -= currentBet;
          if (coins < 0) coins = 0;
          await supabaseClient.from("players").update({ coins }).eq("username", currentUser.username);
          document.getElementById("coinCount").innerText = coins;
          showNotification("😢 Incorrecto. Perdiste " + currentBet + " monedas");
        }
      }

      if (training) {
        trainingQuestionsLeft--;
        if (trainingQuestionsLeft > 0) {
          setTimeout(() => startGame(), 1500);
        } else {
          alert("Finalizaste tu entrenamiento. Compra monedas para continuar.");
          trainingMode = false;
          document.getElementById('store').style.display = "block";
        }
      }
    }

    // ======== RANKING ========
    async function showRanking() {
      document.getElementById("ranking").style.display = "block";
      const { data: players } = await supabaseClient
        .from("players")
        .select("username, coins")
        .order("coins", { ascending: false })
        .limit(10);

      const list = document.getElementById("ranking-list");
      list.innerHTML = "";
      players.forEach((p, i) => {
        let cls = "";
        if (i === 0) cls = "gold";
        else if (i === 1) cls = "silver";
        else if (i === 2) cls = "bronze";
        list.innerHTML += `<li class="${cls}"><span>${i+1}. ${p.username}</span><span>${p.coins} monedas</span></li>`;
      });
    }
   // ======== CHAT GLOBAL ========
    async function loadGlobalChat() {
      document.getElementById("chat").style.display = "block";
      fetchGlobalMessages();

      // Suscripción en tiempo real
      supabaseClient
        .channel("chat-global")
        .on(
          "postgres_changes",
          { event: "INSERT", schema: "public", table: "chat" },
          payload => {
            addMessageToChat(payload.new);
          }
        )
        .subscribe();
    }

    async function fetchGlobalMessages() {
      const { data: messages } = await supabaseClient
        .from("chat")
        .select("*")
        .order("created_at", { ascending: true });

      const chatBox = document.getElementById("chat-box");
      chatBox.innerHTML = "";
      messages.forEach(msg => addMessageToChat(msg));
    }

    function addMessageToChat(msg) {
      const chatBox = document.getElementById("chat-box");
      const div = document.createElement("div");
      div.className = "message";

      let sender = msg.sender;
      if (msg.is_global) sender = "Vicentinos Challenge";
      if (msg.is_admin && !msg.is_global) sender = "Soporte";

      div.innerHTML = `<strong>${sender}:</strong> ${msg.content}`;
      chatBox.appendChild(div);
      chatBox.scrollTop = chatBox.scrollHeight;

      if (msg.sender !== currentUser.username) {
        showNotification("📩 Nuevo mensaje de " + sender);
      }
    }

    async function sendMessage() {
      const input = document.getElementById("chat-input");
      const content = input.value.trim();
      if (!content) return;

      await supabaseClient.from("chat").insert([{
        sender: currentUser.username,
        content,
        is_admin: isAdmin,
        is_global: false
      }]);

      input.value = "";
    }

    // ======== CHAT PRIVADO ========
    async function openPrivateChat() {
      const toUser = prompt("Escribe el nombre del jugador con el que deseas chatear:");
      if (!toUser) return;

      document.getElementById("private-chat").style.display = "block";
      document.getElementById("private-chat-title").innerText = "Chat con " + toUser;

      fetchPrivateMessages(toUser);

      supabaseClient
        .channel("chat-private-" + toUser)
        .on(
          "postgres_changes",
          { event: "INSERT", schema: "public", table: "private_chat" },
          payload => {
            if ((payload.new.sender === toUser && payload.new.receiver === currentUser.username) ||
                (payload.new.sender === currentUser.username && payload.new.receiver === toUser)) {
              addPrivateMessage(payload.new, toUser);
            }
          }
        )
        .subscribe();

      window.currentPrivateReceiver = toUser;
    }

    async function fetchPrivateMessages(toUser) {
      const { data: messages } = await supabaseClient
        .from("private_chat")
        .select("*")
        .or(`and(sender.eq.${currentUser.username},receiver.eq.${toUser}),and(sender.eq.${toUser},receiver.eq.${currentUser.username})`)
        .order("created_at", { ascending: true });

      const box = document.getElementById("private-chat-box");
      box.innerHTML = "";
      messages.forEach(msg => addPrivateMessage(msg, toUser));
    }

    function addPrivateMessage(msg, toUser) {
      const box = document.getElementById("private-chat-box");
      const div = document.createElement("div");
      div.className = "message " + (msg.sender === currentUser.username ? "me" : "other");
      div.innerHTML = `<strong>${msg.sender}:</strong> ${msg.content}`;
      box.appendChild(div);
      box.scrollTop = box.scrollHeight;
    }

    async function sendPrivateMessage() {
      const input = document.getElementById("private-chat-input");
      const content = input.value.trim();
      if (!content || !window.currentPrivateReceiver) return;

      await supabaseClient.from("private_chat").insert([{
        sender: currentUser.username,
        receiver: window.currentPrivateReceiver,
        content
      }]);

      input.value = "";
    }

    // ======== MENSAJES GLOBALES DEL ADMIN ========
    async function sendGlobalMessage() {
      if (!isAdmin) return;
      const msg = prompt("Escribe el mensaje global para todos los jugadores:");
      if (!msg) return;

      await supabaseClient.from("chat").insert([{
        sender: "admin",
        content: msg,
        is_admin: true,
        is_global: true
      }]);
    }

    // ======== LOGOUT ========
    function logout() {
      location.reload();
    }
  </script>

  <!-- ======== INTERFAZ CHAT ======== -->
  <div id="chat" style="display:none;">
    <h2>Chat Global</h2>
    <div id="chat-box"></div>
    <div class="chat-input">
      <input type="text" id="chat-input" placeholder="Escribe un mensaje..."/>
      <button onclick="sendMessage()">Enviar</button>
    </div>
    <button onclick="openPrivateChat()">Chatear en privado</button>
  </div>

  <!-- ======== INTERFAZ CHAT PRIVADO ======== -->
  <div id="private-chat" style="display:none;">
    <h2 id="private-chat-title">Chat Privado</h2>
    <div id="private-chat-box"></div>
    <div class="chat-input">
      <input type="text" id="private-chat-input" placeholder="Escribe un mensaje..."/>
      <button onclick="sendPrivateMessage()">Enviar</button>
    </div>
  </div>
 <!-- ======== PANEL ADMIN ======== -->
  <div id="admin-panel" style="display:none;">
    <h2>Panel de Administración</h2>

    <div class="admin-section">
      <h3>🔑 Gestión de Usuarios</h3>
      <input type="text" id="admin-username" placeholder="Nombre de usuario"/>
      <button onclick="addCoins()">➕ Sumar 1000 monedas</button>
      <button onclick="removeCoins()">➖ Restar 500 monedas</button>
      <button onclick="blockUser()">🚫 Bloquear usuario</button>
    </div>

    <div class="admin-section">
      <h3>💬 Mensajes</h3>
      <button onclick="deleteLastMessage()">🗑️ Borrar último mensaje global</button>
      <button onclick="sendGlobalMessage()">📢 Enviar mensaje global</button>
      <input type="text" id="admin-alias" placeholder="Alias (ej: Soporte, Moderador)" />
      <button onclick="setAdminAlias()">✅ Cambiar alias</button>
    </div>

    <button onclick="logout()">Cerrar sesión</button>
  </div>

  <script>
    let adminAlias = "Soporte";

    async function addCoins() {
      const username = document.getElementById("admin-username").value.trim();
      if (!username) return alert("Ingrese un nombre de usuario");

      let { data, error } = await supabaseClient.rpc("increment_coins", {
        username_input: username,
        coins_to_add: 1000
      });

      if (error) alert("Error al sumar monedas");
      else alert("Se sumaron 1000 monedas a " + username);
    }

    async function removeCoins() {
      const username = document.getElementById("admin-username").value.trim();
      if (!username) return alert("Ingrese un nombre de usuario");

      let { data, error } = await supabaseClient.rpc("decrement_coins", {
        username_input: username,
        coins_to_remove: 500
      });

      if (error) alert("Error al restar monedas");
      else alert("Se restaron 500 monedas a " + username);
    }

    async function blockUser() {
      const username = document.getElementById("admin-username").value.trim();
      if (!username) return alert("Ingrese un nombre de usuario");

      let { error } = await supabaseClient
        .from("users")
        .update({ blocked: true })
        .eq("username", username);

      if (error) alert("Error al bloquear");
      else alert("Usuario " + username + " bloqueado");
    }

    async function deleteLastMessage() {
      let { data, error } = await supabaseClient
        .from("chat")
        .select("*")
        .order("created_at", { ascending: false })
        .limit(1);

      if (data && data.length > 0) {
        await supabaseClient.from("chat").delete().eq("id", data[0].id);
        alert("Último mensaje eliminado");
      } else {
        alert("No hay mensajes para borrar");
      }
    }

    async function sendGlobalMessage() {
      if (!isAdmin) return;
      const msg = prompt("Escribe el mensaje global:");
      if (!msg) return;

      await supabaseClient.from("chat").insert([{
        sender: "Vicentinos Challenge",
        content: msg,
        is_admin: true,
        is_global: true
      }]);

      alert("Mensaje global enviado");
    }

    function setAdminAlias() {
      const alias = document.getElementById("admin-alias").value.trim();
      if (alias) {
        adminAlias = alias;
        alert("Alias cambiado a: " + adminAlias);
      }
    }
  </script>
 <!-- ======== RANKING ======== -->
  <div id="ranking" style="display:none;">
    <h2>🏆 Ranking de Jugadores</h2>
    <ul id="ranking-list"></ul>
    <button onclick="showMenu()">⬅️ Volver</button>
  </div>

  <!-- ======== NOTIFICACIONES ======== -->
  <div id="notification" class="notification"></div>

  <script>
    // ===================== RANKING =====================
    async function loadRanking() {
      let { data, error } = await supabaseClient
        .from("users")
        .select("username, coins")
        .order("coins", { ascending: false })
        .limit(20);

      const list = document.getElementById("ranking-list");
      list.innerHTML = "";

      if (data) {
        data.forEach((user, index) => {
          let li = document.createElement("li");
          if (index === 0) li.classList.add("gold");
          else if (index === 1) li.classList.add("silver");
          else if (index === 2) li.classList.add("bronze");

          li.innerHTML = `<span>${index + 1}. ${user.username}</span> <span>${user.coins} 💰</span>`;
          list.appendChild(li);
        });
      }
    }

    // ===================== NOTIFICACIONES =====================
    function showNotification(msg, type="info") {
      const notif = document.getElementById("notification");
      notif.textContent = msg;
      notif.className = "notification " + type;
      notif.style.display = "block";
      setTimeout(() => notif.style.display = "none", 3000);
    }

    // Ejemplo de uso
    function notifyWin(amount) {
      showNotification(`🎉 ¡Ganaste ${amount} monedas!`, "success");
    }

    function notifyLoss(amount) {
      showNotification(`💔 Perdiste ${amount} monedas`, "error");
    }

    function notifyMessage(sender) {
      showNotification(`📩 Nuevo mensaje de ${sender}`, "message");
    }
  </script>

  <!-- ======== ESTILOS EXTRA ======== -->
  <style>
    /* Ranking */
    #ranking-list {
      list-style: none;
      padding: 0;
    }
    #ranking-list li {
      padding: 10px;
      font-size: 18px;
      display: flex;
      justify-content: space-between;
      border-bottom: 1px solid #ccc;
      animation: slideIn 0.5s ease;
    }
    #ranking-list li.gold { background: linear-gradient(to right, #ffd700, #ffec8b); font-weight: bold; }
    #ranking-list li.silver { background: linear-gradient(to right, #c0c0c0, #e6e6e6); font-weight: bold; }
    #ranking-list li.bronze { background: linear-gradient(to right, #cd7f32, #e6b98d); font-weight: bold; }

    /* Notificaciones */
    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 15px 20px;
      border-radius: 8px;
      font-size: 18px;
      font-weight: bold;
      color: white;
      display: none;
      z-index: 2000;
      animation: fadeIn 0.5s ease;
    }
    .notification.info { background: #3498db; }
    .notification.success { background: #2ecc71; }
    .notification.error { background: #e74c3c; }
    .notification.message { background: #9b59b6; }

    /* Animaciones */
    @keyframes slideIn {
      from { transform: translateX(-100%); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    /* Responsive */
    @media (max-width: 768px) {
      #ranking-list li {
        font-size: 14px;
        padding: 8px;
      }
      .notification {
        font-size: 14px;
        padding: 10px;
      }
    }
  </style>

  <!-- ======== CIERRE DOCUMENTO ======== -->
  <script>
    function logout() {
      currentUser = null;
      currentCoins = 0;
      document.getElementById("game").style.display = "none";
      document.getElementById("admin-panel").style.display = "none";
      document.getElementById("menu").style.display = "none";
      document.getElementById("login").style.display = "block";
    }
  </script>

</body>
</html>
<!-- ============================== -->
<!-- VICENTINOS CHALLENGE - BLOQUE FINAL -->
<!-- Ranking Animado + Notificaciones + Global Messages + Estética + Logout -->
<!-- ============================== -->

<!-- Ranking -->
<section id="rankingSection" class="section hidden">
  <h2 class="section-title">🏆 Ranking Global</h2>
  <div id="rankingList" class="ranking-list"></div>
</section>

<!-- Notificaciones emergentes -->
<div id="notificationContainer" class="notification-container"></div>

<!-- Footer fijo con logout -->
<footer class="footer">
  <p>© 2025 Vicentinos Challenge</p>
  <button id="logoutBtn" class="btn-logout">🚪 Salir</button>
</footer>

<style>
/* ============================== */
/* ESTILOS RANKING Y ANIMACIONES   */
/* ============================== */
.ranking-list {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 12px;
  margin-top: 20px;
  animation: slideUp 1s ease;
}
.ranking-item {
  width: 90%;
  max-width: 400px;
  padding: 12px 18px;
  border-radius: 12px;
  background: #fff;
  font-weight: bold;
  text-align: left;
  display: flex;
  justify-content: space-between;
  align-items: center;
  box-shadow: 0 4px 10px rgba(0,0,0,0.15);
  transition: transform 0.3s;
}
.ranking-item:hover { transform: scale(1.05); }
.ranking-1 { background: linear-gradient(45deg,#ffd700,#ffec8b); color: #000; }
.ranking-2 { background: linear-gradient(45deg,#c0c0c0,#e6e6e6); color: #000; }
.ranking-3 { background: linear-gradient(45deg,#cd7f32,#e1a95f); color: #000; }
.ranking-other { background: #fafafa; color: #333; }

/* Notificaciones emergentes */
.notification-container {
  position: fixed;
  top: 20px;
  right: 20px;
  z-index: 2000;
}
.notification {
  background: #4caf50;
  color: #fff;
  padding: 14px 20px;
  margin-bottom: 12px;
  border-radius: 10px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.2);
  animation: fadeInOut 3s forwards;
  font-weight: bold;
}
.notification.error { background: #e53935; }
.notification.info { background: #2196f3; }

/* Footer */
.footer {
  position: fixed;
  bottom: 0;
  width: 100%;
  background: #1e1e1e;
  color: #fff;
  padding: 12px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}
.btn-logout {
  background: #e53935;
  border: none;
  color: #fff;
  padding: 8px 14px;
  border-radius: 8px;
  cursor: pointer;
  font-weight: bold;
}
.btn-logout:hover { background: #b71c1c; }

/* Animaciones */
@keyframes fadeInOut {
  0% { opacity: 0; transform: translateY(-10px); }
  10% { opacity: 1; transform: translateY(0); }
  90% { opacity: 1; transform: translateY(0); }
  100% { opacity: 0; transform: translateY(-10px); }
}
@keyframes slideUp {
  from { opacity: 0; transform: translateY(30px); }
  to { opacity: 1; transform: translateY(0); }
}
</style>

<script>
// ==============================
// RANKING DINÁMICO
// ==============================
async function loadRanking() {
  const { data, error } = await supabase
    .from("users")
    .select("username, coins")
    .order("coins", { ascending: false })
    .limit(20);

  const rankingList = document.getElementById("rankingList");
  rankingList.innerHTML = "";

  if (error) {
    console.error("Error ranking:", error.message);
    return;
  }

  data.forEach((user, index) => {
    const div = document.createElement("div");
    div.classList.add("ranking-item");

    if (index === 0) div.classList.add("ranking-1");
    else if (index === 1) div.classList.add("ranking-2");
    else if (index === 2) div.classList.add("ranking-3");
    else div.classList.add("ranking-other");

    div.innerHTML = `<span>${index+1}. ${user.username}</span> <span>💰 ${user.coins}</span>`;
    rankingList.appendChild(div);
  });
}

// ==============================
// NOTIFICACIONES EMERGENTES
// ==============================
function showNotification(message, type="success") {
  const container = document.getElementById("notificationContainer");
  const div = document.createElement("div");
  div.classList.add("notification");
  if (type === "error") div.classList.add("error");
  if (type === "info") div.classList.add("info");
  div.textContent = message;
  container.appendChild(div);
  setTimeout(() => div.remove(), 3000);
}

// ==============================
// MENSAJES GLOBALES (ALIAS VICENTINOS CHALLENGE)
// ==============================
async function sendGlobalMessage(content) {
  const { error } = await supabase.from("chat").insert([
    {
      user_id: null, 
      message: `📢 [Vicentinos Challenge]: ${content}`
    }
  ]);
  if (!error) {
    showNotification("Mensaje global enviado", "info");
    loadChat();
  } else {
    console.error("Error global message:", error.message);
  }
}

// ==============================
// LOGOUT
// ==============================
document.getElementById("logoutBtn").addEventListener("click", () => {
  localStorage.clear();
  location.reload();
});

// ==============================
// EVENTOS
// ==============================
document.addEventListener("DOMContentLoaded", () => {
  loadRanking();
});
</script>

</body>
</html>
